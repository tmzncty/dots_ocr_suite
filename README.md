# DotsOCR 套件 (DotsOCR Suite)

这是一个基于 DotsOCR 库开发的 OCR（光学字符识别）处理工具箱，包含 PDF 转 Word (DOCX) 的完整应用。

本项目旨在提供简单易用的工具，帮助用户将 PDF 文档或图片转换为可编辑的 Word 文档或 Markdown 格式，支持复杂的版面分析（如表格、公式、图片等）。

## 📦 包含组件

本项目包含两个主要工具，分别适用于不同的使用场景：

### 1. PDF 转 DOCX 转换器 (完整版)
位于 `pdf_converter/` 目录下。这是一个功能完整的 Web 应用，适合日常使用。
*   **主要功能**：
    *   📄 **拖拽上传**：直接将 PDF 文件拖入网页即可开始。
    *   🔄 **全自动处理**：自动进行拆图、OCR 识别、版面分析。
    *   🚀 **多进程加速**：利用多核 CPU 并行处理，大幅提升长文档的转换速度。
    *   📊 **实时进度**：清晰展示拆图、识别、生成的每一个步骤进度。
    *   📦 **多种下载**：支持下载 Word 文档 (.docx) 或包含 Markdown、JSON 数据的 ZIP 压缩包。
    *   💾 **智能缓存**：相同文件无需重复识别，秒级获取结果。
*   **适用人群**：需要将 PDF 转换为 Word 文档的普通用户。

### 2. 简易 Web 服务器 (测试版)
文件名为 `web_server.py`。这是一个轻量级的测试工具。
*   **主要功能**：上传图片或 PDF，查看识别后的版面分析结果（可视化框图）和 Markdown 源码。
*   **适用人群**：开发者或需要调试 OCR 效果的用户。

### 3. 核心库 (`dots_ocr_lib.py`)
这是项目的核心引擎，封装了与后端 OCR 模型通信的逻辑。

---

## 🛠️ 安装指南 (小白必看)

### 第一步：准备环境
确保你的电脑上安装了 **Python 3.8** 或更高版本。
如果没有安装，请访问 [Python 官网](https://www.python.org/downloads/) 下载并安装（安装时记得勾选 "Add Python to PATH"）。

### 第二步：下载代码
1.  点击网页右上角的 **Code** 按钮，选择 **Download ZIP**。
2.  解压下载的压缩包到你喜欢的文件夹（例如 `D:\DotsOCR`）。

### 第三步：安装依赖库
1.  打开文件夹，在地址栏输入 `cmd` 并回车，打开命令行窗口。
2.  输入以下命令并回车，等待安装完成：
    ```bash
    pip install -r requirements.txt
    ```
    *如果下载速度慢，可以使用国内镜像源：*
    ```bash
    pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
    ```

---

## 🚀 使用说明

### 场景一：我想把 PDF 转成 Word (支持批量)

1.  在项目文件夹中，双击打开命令行（或者在地址栏输 `cmd`）。
2.  输入以下命令启动服务：
    ```bash
    cd pdf_converter
    python server.py
    ```
3.  看到类似 `Server running on port 7860` 的提示后，不要关闭窗口。
4.  打开浏览器（推荐 Chrome 或 Edge），访问：[http://localhost:7860](http://localhost:7860)
5.  **批量转换**：在“批量处理”标签页，您可以一次性拖入多个 PDF 文件。
6.  **自动排队**：文件会自动进入队列逐个处理。您可以在下方列表中查看每个文件的实时进度。
7.  **历史记录**：处理完成后，可以在“历史记录”标签页找到所有文件并下载。

### 场景二：我想测试一下 OCR 效果

1.  在项目根目录下，输入：
    ```bash
    python web_server.py
    ```
2.  打开浏览器访问：[http://localhost:7860](http://localhost:7860)

---

## 🖥️ 如何长期稳定运行 (推荐)

如果你希望服务一直运行，即使意外报错也能自动重启，请使用我们准备好的启动脚本：

1.  在项目根目录下找到 `start_server.bat` 文件。
2.  **双击运行**该文件。
3.  它会自动启动服务，并在服务意外退出时自动重启。
4.  只要不关闭这个黑色窗口，服务就会一直在线。

---

## ⚙️ 配置说明

本项目默认连接的 OCR 后端地址为 `192.168.24.78:8000`。
如果你有自己的 OCR 服务器，或者后端地址发生了变化，请修改 `dots_ocr_lib.py` 文件中的配置，或者在 `server.py` 中修改 `DotsOCRParser` 的初始化参数。

## 📝 版本信息
*   **当前版本**: v1.4
*   **更新日期**: 2025-12-13

## 📅 更新日志 (Changelog)
### v1.4 (2025-12-13)
本次更新带来了全新的**批量处理队列**、**历史记录**以及**繁体中文界面**。

#### ✨ 重大更新
*   **📚 批量处理队列 (Batch Queue)**：
    *   支持一次性拖入多个 PDF 文件，系统会自动加入队列并逐个处理。
    *   无需等待上一个文件完成即可上传新文件，大幅提升工作效率。
*   **🌏 界面升级**：
    *   全站界面更新为**繁体中文**。
    *   引入 **霞鹜文楷 (LXGW WenKai Mono)** 字体，代码和文字显示更舒适。
*   **📜 历史记录 (History)**：
    *   新增“历史记录”标签页，自动保存已处理的文件记录。
    *   即使刷新页面，也能随时找回并下载之前的 DOCX、Markdown 或图片包。
*   **⚙️ 高级设置 (Settings)**：
    *   新增“设置”面板，允许手动调整 **并发图片数** 和 **并发 PDF 数**。
    *   用户可根据显存大小灵活调整负载（例如 3090 可开高并发）。

#### 🛠️ 功能优化
*   **✂️ DOCX 自动分割**：
    *   针对超长文档（如 1000+ 页），生成的 Word 文档会自动按每 300 页分割为多个文件，避免 Word 打开缓慢。

### v1.3（2025年12月13日 00:25:31）
感谢qingkong9579提供的PR，我们在两张3090上测试成功。主要是为了~~打原神~~所以才用windows26H1。这样的话两张卡可以运行两个VLLM然后完美调度。
<img width="1926" height="300" alt="image" src="https://github.com/user-attachments/assets/75451fee-47f2-445c-a1de-510f1014a7a2" />

<img width="1310" height="823" alt="1ffae81d64cc8cd68204829d3ed3aa4" src="https://github.com/user-attachments/assets/7a111aa8-24fc-4eb7-be7b-7205ec9d8548" />


### v1.2 (2025-12-09)
本次更新重点增强了**稳定性**、**可观测性**以及**数据导出**的多样性。

#### ✨ 新增功能
*   **📄 TXT 纯文本导出**：
    *   新增 TXT 格式下载选项，方便用户获取纯文本内容，去除 Markdown 格式标记。
*   **📊 实时状态监控**：
    *   OCR 处理过程中现在会实时显示**处理速度** (页/秒) 和 **预计完成时间 (ETA)** (UTC+8 时区)，让等待不再焦虑。
*   **🔄 自动重试机制**：
    *   针对网络波动导致的请求超时，增加了自动重试逻辑（默认重试 3 次），显著提高了批量处理时的成功率。

#### 🛠️ 系统优化
*   **📝 增强日志系统**：
    *   引入了专业的日志管理系统，日志文件保存在 `logs/server.log`。
    *   支持日志自动轮转（防止文件过大），记录详细的业务操作（上传、下载、处理状态）和异常堆栈，同时屏蔽了冗余的底层库日志，方便排查问题。
*   **⚡ 异步进度更新**：
    *   优化了多进程处理逻辑，采用异步无序返回 (`imap_unordered`)，只要有页面处理完成即刻更新进度条，视觉反馈更加流畅。

### v1.1 (2025-12-08)
本次更新主要集中在**大文件处理能力**、**容错性**以及**用户体验**的提升。

#### ✨ 新增功能
*   **🔄 重新处理 (Reprocess)**：
    *   针对处理中断、网络超时或意外报错的任务，新增"重新处理"按钮。
    *   **智能断点续传**：自动检测已完成的步骤（如已拆解的图片、已完成 OCR 的页面），跳过重复工作，仅处理未完成的部分，极大节省时间。
*   **🖼️ 下载原图 (Download Images)**：
    *   新增图片包下载功能，可将 PDF 拆解后的所有高清页面图片打包为 ZIP 下载。

#### ⚡ 性能优化
*   **🚀 并行拆图**：
    *   重构了 PDF 页面提取逻辑，采用多进程并行处理。
    *   充分利用多核 CPU 性能，大幅提升了长文档（数百页以上）的预处理速度。
*   **💾 内存优化**：
    *   优化了数据流转机制，提取的图片直接写入硬盘缓存，不再长时间驻留内存。
    *   彻底解决了处理大文件（如 >500页）时服务假死、无响应或内存溢出的问题。

#### 🛡️ 稳定性增强
*   **💪 容错合并**：
    *   增强了最终文档生成阶段的鲁棒性。
    *   即使部分页面因 OCR 失败、文件损坏或数据丢失，程序也能自动跳过错误页面，生成包含其余正常内容的最终文档（错误页面会显示占位符提示），而不会直接报错崩溃。
*   **🔧 错误处理**：
    *   优化了后端 API 的错误响应格式，前端能更准确地捕获并提示具体错误原因（如"文件未找到"、"任务不存在"等）。

---
*如有问题，欢迎提交 Issue 反馈！*
